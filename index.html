<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Indomon Quest - Pre Register</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet"/>
  <style>
    /* ===== Decoration: lightweight & non-blocking ===== */
    .decor { position: absolute; inset: 0; pointer-events: none; z-index: 0; }

    /* semriwing wind blur behind CTA buttons */
    .wind {
      position: absolute;
      width: 220px; height: 220px; border-radius: 50%;
      background: radial-gradient(circle, rgba(255,255,255,0.09) 0%, transparent 70%);
      filter: blur(22px);
      animation: spin 12s linear infinite;
      pointer-events: none; mix-blend-mode: screen;
    }
    @keyframes spin {
      from { transform: rotate(0deg) translateX(60px) rotate(0deg); }
      to   { transform: rotate(360deg) translateX(60px) rotate(-360deg); }
    }

    /* small sparkle deco */
    .sparkle { position:absolute; width:8px; height:8px; border-radius:50%; background:radial-gradient(circle,#fff,rgba(255,255,255,0.6)); opacity:0.9; pointer-events:none; animation: sparkle 3.5s infinite ease-in-out;}
    @keyframes sparkle { 0%,100%{ transform:scale(.5); opacity:0; } 50%{ transform:scale(1.1); opacity:1; } }

    /* leaf (very subtle) */
    .leaf {
      position: fixed; width: 22px; height: 20px; border-radius: 6px; background: rgba(255,255,200,0.08);
      pointer-events:none; z-index:0; animation: leafFall linear;
    }
    @keyframes leafFall { 0% { transform: translateY(-10vh) rotate(0deg); opacity:1 } 100% { transform: translateY(110vh) rotate(360deg); opacity:0 } }

    /* hero glow */
    .glow { animation: glowAnim 2s ease-in-out infinite alternate; pointer-events:none; }
    @keyframes glowAnim { from { text-shadow:0 0 6px #ffd54d } to { text-shadow:0 0 18px #ffd54d } }

    /* accessibility: respect user preference */
    @media (prefers-reduced-motion: reduce) {
      .wind, .sparkle, .glow, .leaf, .animate__animated { animation: none !important; transition: none !important; }
    }

    /* reduce decorations on small screens */
    @media (max-width: 640px) {
      .wind { display:none; }
      .sparkle { display:none; }
    }

    /* content layering */
    main { position: relative; z-index: 10; }

    /* animasi smooth height */
    #referral-content {
      transition: max-height 0.5s ease-in-out, opacity 0.5s ease-in-out;
      max-height: 0;
      opacity: 0;
      overflow: hidden;
    }
    #referral-content.open {
      max-height: 500px; /* cukup besar untuk isi */
      opacity: 1;
    }
  </style>
</head>
<body class="bg-gradient-to-b from-indigo-950 to-gray-900 text-white font-sans antialiased">
  <!-- Loading Spinner -->
  <div id="loading" class="fixed inset-0 bg-black bg-opacity-60 hidden flex-col items-center justify-center z-50">
    <div class="flex flex-col items-center text-gray-300 space-y-3">
      <svg class="animate-spin h-8 w-8 text-yellow-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8z"></path>
      </svg>
      <p class="animate-pulse" data-i18n="loading">â³ Memuat...</p>
    </div>
  </div>

  <!-- Decorative layer -->
  <div class="decor" aria-hidden="true">
    <div class="wind" style="top:46%; left:28%;"></div>
    <div class="wind" style="top:46%; left:72%; animation-duration:14s;"></div>
    <div class="sparkle" style="top:18%; left:12%; animation-delay:.8s;"></div>
    <div class="sparkle" style="top:28%; left:80%; animation-delay:1.5s;"></div>
  </div>

  <main>
    <!-- HERO -->
    <header class="relative">
      <!-- Tombol Bahasa -->
      <div class="absolute top-4 right-4 flex">
        <button id="lang-id" class="px-2 py-0.2 border rounded">ğŸ‡®ğŸ‡©</button>
        <button id="lang-en" class="ml-2 px-2 py-0.2 border rounded">ğŸ‡ºğŸ‡¸</button>
      </div>

      <div class="text-center py-16 px-4">
        <!-- Judul -->
        <h1
          class="text-4xl sm:text-5xl md:text-6xl font-extrabold mb-3 animate__animated animate__fadeInDown glow"
          data-i18n="hero.title">
          ğŸ¦â€ğŸ”¥ Indomon Quest
        </h1>

        <!-- Subjudul (TEKS SAJA) + tombol collapsible TERPISAH -->
        <p class="text-base sm:text-lg md:text-xl max-w-2xl mx-auto text-gray-200 mb-6 animate__animated animate__fadeInUp">
          <span data-i18n="hero.subtitle">
            Jelajahi dunia monster Nusantara. Tangkap, latih, berdagang, dan jadilah Founder. Beli paket Founder sekarang untuk
          </span>
          <button id="toggle-referral"
                  type="button"
                  class="inline-flex items-center font-semibold text-yellow-400 hover:text-yellow-300 focus:outline-none">
            <span data-i18n="referral.title">eksklusif, referral & uang nyata.</span>
            <span id="arrow" class="ml-1 transform transition-transform duration-300">â–¼</span>
          </button>
        </p>

        <!-- Collapsible content -->
        <div id="referral-content"
             class="max-w-xl mx-auto text-sm text-gray-300 mt-3"
             data-i18n="referral.content">
          <!-- diisi otomatis dari JSON (array -> <p>...</p>) -->
        </div>

        <!-- Tombol aksi -->
        <div class="flex flex-col sm:flex-row items-center justify-center gap-3 mt-6">
          <a href="#packages"
             class="px-5 py-3 bg-yellow-500 text-black font-bold rounded-xl shadow hover:bg-yellow-400 transform transition hover:scale-105"
             data-i18n="hero.btn_packages">Lihat Paket</a>
          <a href="#register"
             class="px-5 py-3 border border-gray-700 rounded-xl text-gray-200 hover:bg-gray-800"
             data-i18n="hero.btn_register">Pra-Registrasi</a>
        </div>
      </div>
    </header>

    <!-- QUOTA -->
    <section class="max-w-3xl mx-auto text-center py-6 px-4">
      <h2 class="text-2xl font-bold mb-2" data-i18n="quota.title">âš¡ Kuota Founder Terbatas</h2>
      <p class="text-sm text-gray-300 mb-3" data-i18n="quota.desc">Diskon 90% hanya untuk 10.000 pemain pertama. Setelah kuota habis pendaftaran akan ditutup.</p>
      <div class="bg-gray-700 rounded-full h-8 w-full overflow-hidden">
        <div id="quota-bar" class="bg-yellow-500 h-8 text-black font-bold flex items-center justify-center text-sm" style="width:75%">
          7.500 / 10.000 (75%)
        </div>
      </div>
      <p id="quota-remaining-msg" class="mt-2 text-sm text-gray-300">Quota Remaining: <span id="quota-remaining">2.500</span></p>
    </section>

    <!-- WHY JOIN -->
    <section class="max-w-6xl mx-auto px-4 py-8">
      <h3 class="text-2xl font-bold mb-4 text-center" data-i18n="why_join.title">Kenapa Harus Join Early?</h3>
      <div class="grid grid-cols-1 sm:grid-cols-3 gap-6">
        <div class="bg-gray-900 p-4 rounded-xl shadow">
          <h4 class="font-bold mb-2" data-i18n="why_join.reasons.reward.title">ğŸ Reward Eksklusif</h4>
          <p class="text-sm text-gray-300" data-i18n="why_join.reasons.reward.desc">Paket Founder berisi monster, equipment, potion & alat tangkap eksklusif yang tidak dijual lagi setelah rilis.</p>
        </div>
        <div class="bg-gray-900 p-4 rounded-xl shadow">
          <h4 class="font-bold mb-2" data-i18n="why_join.reasons.early.title">ğŸš€ Early Access & Events</h4>
          <p class="text-sm text-gray-300" data-i18n="why_join.reasons.early.desc">Akses closed alpha/beta, event khusus Founder, dan kesempatan jadi Breeder awal.</p>
        </div>
        <div class="bg-gray-900 p-4 rounded-xl shadow">
          <h4 class="font-bold mb-2" data-i18n="why_join.reasons.referral.title">ğŸ’¸ Monetisasi & Referral</h4>
          <p class="text-sm text-gray-300" data-i18n="why_join.reasons.referral.desc">Dapat referral 10% dari pembelian teman. Referral aktif setelah pembayaran & verifikasi. Reward referral dapat ditukar hadiah uang sebesar maksimal 50% dari total reward referral</p>
        </div>
      </div>
    </section>

    <!-- FEATURES -->
    <section class="max-w-6xl mx-auto px-4 py-8">
      <h3 class="text-2xl font-bold mb-4 text-center" data-i18n="features.title">Fitur Utama Indomon Quest</h3>
      <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4">
        <div class="bg-gray-900 p-4 rounded-xl text-center">
          <div class="text-xl font-semibold mb-2" data-i18n="features.items.collection.title">ğŸ² Monster Collection</div>
          <div class="text-sm text-gray-300" data-i18n="features.items.collection.desc">100+ Field & 100+ Breeding unik bernuansa Nusantara dan terus bertambah seiring berkembangnya game.</div>
        </div>
        <div class="bg-gray-900 p-4 rounded-xl text-center">
          <div class="text-xl font-semibold mb-2" data-i18n="features.items.combat.title">âš”ï¸ Turn-based Combat</div>
          <div class="text-sm text-gray-300" data-i18n="features.items.combat.desc">Battle teks strategis, capture, dan skill unik tiap monster.</div>
        </div>
        <div class="bg-gray-900 p-4 rounded-xl text-center">
          <div class="text-xl font-semibold mb-2" data-i18n="features.items.economy.title">ğŸ­ Profesi & Ekonomi</div>
          <div class="text-sm text-gray-300" data-i18n="features.items.economy.desc">Farmer, Miner, Blacksmith, Alchemist, Fisher & Chef serta Breeder sebagai profesi prestise setelah profesi utama max level. Saling beri nilai ekonomi.</div>
        </div>
        <div class="bg-gray-900 p-4 rounded-xl text-center">
          <div class="text-xl font-semibold mb-2" data-i18n="features.items.market.title">ğŸŒ Global Market</div>
          <div class="text-sm text-gray-300" data-i18n="features.items.market.desc">Jual-beli monster, item & equipment di pasar global dengan trading pair.</div>
        </div>
      </div>
    </section>

    <!-- PACKAGES -->
    <section id="packages" class="py-12 px-4">
      <h3 class="text-3xl font-bold text-center mb-8" data-i18n="packages.title">ğŸ Paket Founder Diskon 90%</h3>
      <div class="max-w-6xl mx-auto grid grid-cols-1 md:grid-cols-3 gap-6">
        <!-- GOLD -->
        <div class="bg-gray-900 p-6 rounded-2xl shadow relative overflow-hidden">
          <h4 class="text-xl font-bold mb-1" data-i18n="packages.gold.name">Gold Pack</h4>
          <p class="text-gray-400 line-through" data-i18n="packages.gold.price_old">Rp 100.000</p>
          <p class="text-2xl font-bold text-yellow-400 mb-2" data-i18n="packages.gold.price_new">Rp 10.000</p>
          <p class="text-xs text-gray-300 mb-2" data-i18n="packages.gold.referral">Bonus Referral: 10%</p>
          <ul class="text-sm text-gray-300 mb-4 space-y-1 text-left" data-i18n="[html]packages.gold.items">
            <li>ğŸª™ <strong>1x Monster Rare</strong> (random)</li>
            <li>ğŸª™ <strong>1x Full Set Equipment (Rare)</strong></li>
            <li>ğŸª™ <strong>25x Potion Exp (Small)</strong></li>
            <li>ğŸª™ <strong>15x Alat Tangkap (Basic)</strong></li>
            <li>ğŸª™ <strong>10x Item Uncommon</strong></li>
          </ul>
          <a id="buy-gold" href="https://digidikari.myr.id/pl/gold-pack" target="_blank" class="inline-block px-5 py-2 bg-yellow-400 text-black font-bold rounded-lg hover:bg-yellow-400 z-10 relative" data-i18n="packages.buy_now">Beli Sekarang</a>
          <div class="wind" style="bottom:18px; left:50%; transform:translateX(-50%); animation-duration:11s;"></div>
        </div>

        <!-- PLATINUM -->
        <div class="bg-gray-900 p-6 rounded-2xl shadow-xl relative border-4 border-yellow-400 overflow-hidden">
          <span class="absolute top-6 right-[-40px] rotate-45 bg-yellow-400 text-black text-xs md:text-sm font-bold px-10 py-1 shadow-md animate-pulse inline-block" data-i18n="packages.best_choice">
            BEST CHOICE
          </span>
          <h4 class="text-xl font-bold mb-1" data-i18n="packages.platinum.name">Platinum Pack</h4>
          <p class="text-gray-400 line-through" data-i18n="packages.platinum.price_old">Rp 500.000</p>
          <p class="text-2xl font-bold text-yellow-400 mb-2" data-i18n="packages.platinum.price_new">Rp 50.000</p>
          <p class="text-xs text-gray-300 mb-2" data-i18n="packages.platinum.referral">Bonus Referral: 10%</p>
          <ul class="text-sm text-gray-300 mb-4 space-y-1 text-left" data-i18n="[html]packages.platinum.items">
            <li>ğŸ’¿ <strong>1x Monster Legendary</strong> (random)</li>
            <li>ğŸ’¿ <strong>1x Full Set Equipment (Epic)</strong></li>
            <li>ğŸ’¿ <strong>25x Potion Exp (Medium)</strong></li>
            <li>ğŸ’¿ <strong>15x Alat Tangkap (Advanced)</strong></li>
            <li>ğŸ’¿ <strong>10x Item Rare</strong></li>
            <li>ğŸ’¿ <strong>Exclusive Founder Badge</strong></li>
          </ul>
          <a id="buy-platinum" href="https://digidikari.myr.id/pl/platinum-pack" target="_blank" class="inline-block px-5 py-2 bg-yellow-500 text-black font-bold rounded-lg hover:bg-yellow-400 z-10 relative" data-i18n="packages.buy_now">Beli Sekarang</a>
          <div class="wind" style="bottom:14px; left:50%; transform:translateX(-50%); animation-duration:9s;"></div>
        </div>

        <!-- DIAMOND -->
        <div class="bg-gray-900 p-6 rounded-2xl shadow-lg relative overflow-hidden">
          <h4 class="text-xl font-bold mb-1" data-i18n="packages.diamond.name">Diamond Pack</h4>
          <p class="text-gray-400 line-through" data-i18n="packages.diamond.price_old">Rp 1.000.000</p>
          <p class="text-2xl font-bold text-yellow-400 mb-2" data-i18n="packages.diamond.price_new">Rp 100.000</p>
          <p class="text-xs text-gray-300 mb-2" data-i18n="packages.diamond.referral">Bonus Referral: 10%</p>
          <ul class="text-sm text-gray-300 mb-4 space-y-1 text-left" data-i18n="[html]packages.diamond.items">
            <li>ğŸ’ <strong>1x Monster Legendary Eksklusif</strong></li>
            <li>ğŸ’ <strong>1x Full Set Equipment (Legendary)</strong></li>
            <li>ğŸ’ <strong>25x Potion Exp (Large)</strong></li>
            <li>ğŸ’ <strong>15x Alat Tangkap (Pro)</strong></li>
            <li>ğŸ’ <strong>10x Item Legendary</strong></li>
            <li>ğŸ’ <strong>Exclusive Founder Badge</strong></li>
            <li>ğŸ’ <strong>Nama di Credits</strong></li>
          </ul>
          <a id="buy-diamond" href="https://digidikari.myr.id/pl/diamond-pack" target="_blank" class="inline-block px-5 py-2 bg-yellow-500 text-black font-bold rounded-lg hover:bg-yellow-400 z-10 relative" data-i18n="packages.buy_now">Beli Sekarang</a>
          <div class="wind" style="bottom:18px; left:50%; transform:translateX(-50%); animation-duration:12s;"></div>
        </div>
      </div>

      <!-- Popup Modal -->
      <div id="payment-modal" class="fixed inset-0 bg-black bg-opacity-60 hidden items-center justify-center z-50">
        <div class="bg-gray-900 rounded-2xl p-6 w-80 text-center shadow-xl">
          <h3 class="text-xl font-bold mb-4" data-i18n="payment_modal.title">Pilih Metode Pembayaran</h3>
          <div class="space-y-3">
            <button id="pay-mayar" class="w-full px-4 py-2 bg-yellow-500 text-black font-bold rounded-lg hover:bg-yellow-400" data-i18n="payment_modal.pay_mayar">
              ğŸ‡®ğŸ‡© Mayar.id [IDR]
            </button>
            <button id="pay-nowpayments" class="w-full px-4 py-2 bg-indigo-500 text-white font-bold rounded-lg hover:bg-indigo-400" data-i18n="payment_modal.pay_nowpayments">
              ğŸŒ NOWPayments [TON]
            </button>
          </div>
          <button id="close-modal" class="mt-5 text-gray-400 hover:text-gray-200 text-sm" data-i18n="payment_modal.cancel">Batal</button>
        </div>
      </div>
    </section>

    <!-- ROADMAP -->
    <section class="max-w-5xl mx-auto px-4 py-10">
      <h3 class="text-2xl font-bold mb-4 text-center" data-i18n="roadmap.title">Roadmap</h3>
      <ol class="space-y-4 text-sm text-gray-300">
        <li data-i18n="[html]roadmap.q4_2025"><strong>Q4 2025</strong> â€” Closed Alpha (Founder only), implement core loop: explore, battle, capture, website & wiki (halaman informasi, panduan game lengkap)</li>
        <li data-i18n="[html]roadmap.q1_2026"><strong>Q1 2026</strong> â€” Beta Founder & Pra-Registrasi: Profesi dasar + Market + Early PVP Arena.</li>
        <li data-i18n="[html]roadmap.q2_2026"><strong>Q2 2026</strong> â€” Open Beta: Breeder prestige unlock + leaderboard.</li>
        <li data-i18n="[html]roadmap.q3_2026"><strong>Q3 2026</strong> â€” Full Release: Cross-region updates, event reward fiat, mobile optimizations.</li>
        <li data-i18n="[html]roadmap.post"><strong>Post-Launch</strong> â€” Seasonal monsters, new professions, user-requested features.</li>
      </ol>
    </section>

    <!-- FAQ -->
    <section class="max-w-4xl mx-auto px-4 py-8">
      <h3 class="text-2xl font-bold mb-4 text-center" data-i18n="faq.title">FAQ â€” Pertanyaan Umum</h3>
      <div class="space-y-3 text-sm text-gray-300">
        <details class="bg-gray-900 p-3 rounded">
          <summary class="font-semibold" data-i18n="faq.items.earn.q">Bagaimana cara saya mendapatkan uang dari game ini?</summary>
          <div class="mt-2" data-i18n="faq.items.earn.a">Pemain bisa mendapatkan reward dari event, menjual monster/item/equipment di Global Market, dan kompetisi berkala yang memberi hadiah fiat (via payment external).</div>
        </details>
        <details class="bg-gray-900 p-3 rounded">
          <summary class="font-semibold" data-i18n="faq.items.packs.q">Apa bedanya tiap paket Founder?</summary>
          <div class="mt-2" data-i18n="faq.items.packs.a">Setiap paket berbeda pada rarity monster, jumlah potion, alat tangkap, dan akses awal. Paket premium memberi item & badge eksklusif.</div>
        </details>
        <details class="bg-gray-900 p-3 rounded">
          <summary class="font-semibold" data-i18n="faq.items.funds.q">Apakah dana yang terkumpul aman?</summary>
          <div class="mt-2" data-i18n="faq.items.funds.a">Dana digunakan untuk pengembangan game (hosting, dev, art, testing), pemberian reward kepada referrer &.para pemenang kompetisi dll. Semua pembayaran tercatat di sistem. Kami juga menyediakan update berkala progress dev.</div>
        </details>
        <details class="bg-gray-900 p-3 rounded">
          <summary class="font-semibold" data-i18n="faq.items.referral.q">Kapan referral aktif?</summary>
          <div class="mt-2" data-i18n="faq.items.referral.a">Referral aktif setelah login via Beli Package atau via Pra-Registrasi. Reward referral didapat dari referral beli paket lalu pembayaran terkonfirmasi & data pembeli tercatat di database. Link referral akan muncul di dashboard pengguna.</div>
        </details>
      </div>
    </section>

    <!-- REGISTER -->
    <section id="register" class="py-10 px-4">
      <div class="text-center space-y-4">
        <button id="google-login" class="px-4 py-2 bg-red-500 text-white rounded-xl shadow-md" data-i18n="register.login_google">
          Login dengan Google
        </button>
        <p id="form-msg" class="text-sm text-gray-300 mt-2"></p>
      </div>
    </section>

    <!-- FOOTER -->
    <footer class="py-8 text-center text-sm text-gray-400" data-i18n="footer">
      Â© 2025 Indomon Quest. All rights reserved.
    </footer>
  </main>

  <!-- Script Bahasa + Collapsible -->
  <script>
    let currentLang = localStorage.getItem("lang") || "en";
    let currentUsedQuota = 7500; // Default sementara untuk handle timing issue

    async function loadLang(lang) {
      try {
        // Show loading spinner
        const loading = document.getElementById("loading");
        loading.classList.remove("hidden");
        loading.classList.add("flex");

        // Simulate 2-second loading
        await new Promise(resolve => setTimeout(resolve, 2000));

        const res = await fetch(`./lang/${lang}.json`);
        const data = await res.json();
        applyLang(data);
        currentLang = lang;
        localStorage.setItem("lang", lang);
        initReferralToggle(); 
        updateLangButtons();

        // Re-update quota setelah applyLang, pakai cache atau default
        updateQuota(currentUsedQuota);

        // Hide loading spinner
        loading.classList.remove("flex");
        loading.classList.add("hidden");
      } catch (e) {
        console.error("Gagal memuat bahasa:", e);
        // Hide loading spinner on error
        document.getElementById("loading").classList.remove("flex");
        document.getElementById("loading").classList.add("hidden");
        // Fallback quota update
        updateQuota(currentUsedQuota);
      }
    }

    function applyLang(data) {
      document.querySelectorAll("[data-i18n]").forEach(el => {
        const attr = el.getAttribute("data-i18n");
        const isHtml = attr.startsWith("[html]");
        const keys = isHtml ? attr.replace("[html]", "").split(".") : attr.split(".");
        let value = data;
        for (const k of keys) value = value?.[k];

        if (typeof value === "string") {
          el.innerHTML = value;
        } else if (Array.isArray(value) && isHtml) {
          el.innerHTML = value.map(item => `<li>${item}</li>`).join("");
        } else if (Array.isArray(value)) {
          el.innerHTML = value.map(p => `<p>${p}</p>`).join("");
        } else {
          console.warn("âš ï¸ Tidak ada terjemahan untuk", keys.join("."));
        }
      });
    }

    function initReferralToggle() {
      const btn = document.getElementById("toggle-referral");
      const content = document.getElementById("referral-content");
      const arrow = document.getElementById("arrow");
      if (!btn || !content || !arrow) return;

      btn.onclick = () => {
        content.classList.toggle("open");
        arrow.style.transform = content.classList.contains("open") ? "rotate(180deg)" : "rotate(0deg)";
      };
    }

    function updateLangButtons() {
      const btnId = document.getElementById("lang-id");
      const btnEn = document.getElementById("lang-en");
      if (!btnId || !btnEn) return;

      if (currentLang === "id") {
        btnId.classList.add("bg-yellow-400", "text-black");
        btnEn.classList.remove("bg-yellow-400", "text-black");
      } else {
        btnEn.classList.add("bg-yellow-400", "text-black");
        btnId.classList.remove("bg-yellow-400", "text-black");
      }
    }

    // Event listener
    document.getElementById("lang-id").addEventListener("click", () => loadLang("id"));
    document.getElementById("lang-en").addEventListener("click", () => loadLang("en"));

    // First load
    document.addEventListener("DOMContentLoaded", () => {
      loadLang(currentLang);
      initReferralToggle();
    });
  </script>

  <!-- minimal leaf spawner (lightweight) -->
  <script>
    // spawn only up to 3 leaves at a time, less frequent on mobile devices
    const isMobile = window.matchMedia("(max-width:640px)").matches;
    if (!isMobile && window.matchMedia("(prefers-reduced-motion: no-preference)").matches) {
      console.log("ğŸƒ Leaf spawner aktif");
      let activeLeaves = 0;
      function spawnLeaf() {
        if (activeLeaves >= 3) return;
        activeLeaves++;
        const leaf = document.createElement('div');
        leaf.className = 'leaf';
        leaf.style.left = (8 + Math.random() * 84) + 'vw';
        leaf.style.animationDuration = (6 + Math.random() * 6) + 's';
        leaf.style.transform = 'rotate(' + (Math.random()*360) + 'deg)';
        document.body.appendChild(leaf);
        console.log("ğŸƒ Spawn leaf, active:", activeLeaves);
        setTimeout(() => { 
          leaf.remove(); 
          activeLeaves--; 
          console.log("ğŸƒ Remove leaf, active:", activeLeaves);
        }, 11000);
      }
      setInterval(spawnLeaf, 2000);
    } else {
      console.log("ğŸƒ Leaf spawner tidak aktif (mobile atau prefers-reduced-motion)");
    }
  </script>

  <!-- Firebase Script -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { 
      getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut 
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { 
      getFirestore, doc, getDoc, setDoc, updateDoc, serverTimestamp, increment, onSnapshot 
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    // ğŸ”¹ Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyBVCCuIU6O_kwLIu18zFmLKx4nAZ15S5gU",
      authDomain: "indomon-quest.firebaseapp.com",
      projectId: "indomon-quest",
      storageBucket: "indomon-quest.firebasestorage.app",
      messagingSenderId: "483061706588",
      appId: "1:483061706588:web:ef2e02e7e8c2f08c12db99"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const provider = new GoogleAuthProvider();
    const urlParams = new URLSearchParams(window.location.search);
    const refFromUrl = urlParams.get("ref"); // sponsor refNumber (angka)

    // ğŸ”¹ Generator angka referral (auto increment)
    async function getNextRefNumber() {
      const counterRef = doc(db, "counters", "refCount");
      const snap = await getDoc(counterRef);
      if (!snap.exists()) {
        await setDoc(counterRef, { count: 1 });
        return 1;
      }
      const current = snap.data().count;
      await updateDoc(counterRef, { count: increment(1) });
      return current + 1;
    }

    // ğŸ”¹ Buat user baru jika belum ada
    async function ensureUserDoc(user, source = "google") {
      const userRef = doc(db, "users", user.uid);
      const snap = await getDoc(userRef);

      if (!snap.exists()) {
        const newRefNumber = await getNextRefNumber();
        await setDoc(userRef, {
          uid: user.uid,
          refNumber: newRefNumber,
          email: user.email,
          displayName: user.displayName || "",
          photoURL: user.photoURL || "",
          totalReferral: 0,
          reward: 0,
          status: "Free",
          createdAt: serverTimestamp(),
          refBy: refFromUrl ? Number(refFromUrl) : null
        });

        // ğŸ”¹ Mapping refNumber â†’ uid
        await setDoc(doc(db, "refNumber", newRefNumber.toString()), {
          uid: user.uid
        });

        // ğŸ”¹ Tambah referral sponsor (asal bukan self-referral)
        if (refFromUrl && Number(refFromUrl) !== newRefNumber) {
          const refSnap = await getDoc(doc(db, "refNumber", refFromUrl));
          if (refSnap.exists()) {
            const sponsorUid = refSnap.data().uid;
            await updateDoc(doc(db, "users", sponsorUid), {
              totalReferral: increment(1)
            });
          }
        }
      }
      return userRef;
    }

    // ğŸ”¹ LOGIN VIA GOOGLE BUTTON (pra-registrasi)
    document.getElementById("google-login")?.addEventListener("click", async () => {
      try {
        const result = await signInWithPopup(auth, provider);
        await ensureUserDoc(result.user, "google");
        window.location.href = "dashboard.html";
      } catch (err) {
        console.error("Login gagal:", err);
        alert("âŒ Login gagal, coba lagi.");
      }
    });

    // ğŸ”¹ LOGIN VIA PACK (Beli Sekarang)
    const modal = document.getElementById("payment-modal");
    const closeModal = document.getElementById("close-modal");
    let tempCheckoutUrl = null;
    let tempPackId = null;

    // ğŸ”¹ Definisi link NOWPayments per paket
    const nowPaymentsLinks = {
      gold: "https://nowpayments.io/payment/?iid=4543522124&paymentId=4979877379",
      platinum: "https://nowpayments.io/payment/?iid=4711639912&paymentId=6356595345",
      diamond: "https://nowpayments.io/payment/?iid=5612033949&paymentId=4445817386"
    };

    // ğŸ”¹ Klik "Beli Sekarang"
    document.querySelectorAll("[id^=buy-]").forEach(btn => {
      btn.addEventListener("click", async (e) => {
        e.preventDefault();
        tempPackId = btn.id.replace("buy-", "");
        tempCheckoutUrl = btn.getAttribute("href");

        let user = auth.currentUser;
        if (!user) {
          try {
            const result = await signInWithPopup(auth, provider);
            user = result.user;
            await ensureUserDoc(user, "pack"); // simpan setelah login baru
          } catch (error) {
            console.error("Login gagal:", error);
            alert("Login gagal, coba lagi.");
            return;
          }
        } else {
          await ensureUserDoc(user, "pack"); // kalau sudah login simpan juga
        }

        // ğŸ”¹ Setelah login â†’ tampilkan pilihan gateway
        modal.classList.remove("hidden");
        modal.classList.add("flex");
      });
    });

    // ğŸ”¹ Tutup modal
    closeModal.addEventListener("click", () => {
      modal.classList.add("hidden");
      modal.classList.remove("flex");
      tempCheckoutUrl = null;
      tempPackId = null;
    });

    // ğŸ”¹ Success & Cancel URL
    function buildRedirectUrl(packId) {
      const successUrl = encodeURIComponent(`https://www.indomonquest.web.id/validasi.html?pack=${packId}&ref=${refFromUrl || ""}`);
      const cancelUrl = encodeURIComponent(`https://www.indomonquest.web.id/dashboard.html`);
      return { successUrl, cancelUrl };
    }

    // ğŸ”¹ Pilih Mayar
    document.getElementById("pay-mayar").addEventListener("click", () => {
      if (tempCheckoutUrl && tempPackId) {
        const { successUrl, cancelUrl } = buildRedirectUrl(tempPackId);
        window.location.href = `${tempCheckoutUrl}?redirect=${successUrl}&cancel_redirect=${cancelUrl}`;
      }
    });

    // ğŸ”¹ Pilih NOWPayments
    document.getElementById("pay-nowpayments").addEventListener("click", () => {
      if (tempPackId) {
        const { successUrl, cancelUrl } = buildRedirectUrl(tempPackId);
        const baseUrl = nowPaymentsLinks[tempPackId];
        if (baseUrl) {
          window.location.href = `${baseUrl}&success=${successUrl}&cancel=${cancelUrl}`;
        } else {
          console.error("âš ï¸ Link NOWPayments untuk paket", tempPackId, "tidak ditemukan!");
          alert("âŒ Terjadi kesalahan, coba lagi.");
        }
      }
    });

    // ğŸ”¹ LOGOUT + COUNTER
    document.getElementById("google-logout")?.addEventListener("click", async () => {
      await signOut(auth);
      alert("ğŸ‘‹ Anda sudah logout.");
    });

    // ğŸ”¹ Counters
    const totalQuota = 10000;

    // Update tampilan bar kuota
    function updateQuota(usedQuota) {
      currentUsedQuota = usedQuota; // Simpan ke cache
      const remaining = totalQuota - usedQuota;
      const percent = Math.min(100, Math.floor((usedQuota / totalQuota) * 100));

      const bar = document.getElementById("quota-bar");
      const remainingEl = document.getElementById("quota-remaining");
      
      if (bar && remainingEl) {
        bar.style.width = `${percent}%`;
        bar.textContent = `${usedQuota.toLocaleString()} / ${totalQuota.toLocaleString()} (${percent}%)`;
        remainingEl.textContent = remaining.toLocaleString();
        console.log(`ğŸ”¢ UI Kuota diperbarui: ${usedQuota} / ${totalQuota} (${percent}%), Sisa: ${remaining}`);
      } else {
        console.error("âš ï¸ Elemen quota-bar atau quota-remaining tidak ditemukan!");
      }
    }

    // Realtime listener counters/refCount
    const counterRef = doc(db, "counters", "refCount");
    onSnapshot(counterRef, (docSnap) => {
      if (docSnap.exists()) {
        const usedQuota = docSnap.data().count || 0;
        updateQuota(usedQuota);
        console.log("ğŸ”¢ Kuota diperbarui dari Firebase:", usedQuota);
      } else {
        console.error("âš ï¸ Document counters/refCount tidak ditemukan!");
        updateQuota(currentUsedQuota); // Fallback ke cache/default
      }
    }, (error) => {
      console.error("âš ï¸ Gagal mendengarkan perubahan pada counters/refCount:", error);
      updateQuota(currentUsedQuota); // Fallback ke cache/default
    });

    // Inisialisasi quota awal
    updateQuota(currentUsedQuota);
  </script>
</body>
</html>


