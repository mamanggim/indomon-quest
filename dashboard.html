<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Dashboard Player</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen flex items-center justify-center p-4">

  <!-- Dashboard -->
  <div id="dashboard" class="max-w-3xl w-full bg-gray-800 rounded-2xl shadow-lg p-6 opacity-0 transform scale-95 transition-all duration-500 hidden">
    <!-- Header -->
    <div class="flex flex-col sm:flex-row sm:items-center sm:space-x-4 border-b border-gray-700 pb-4 mb-6">
      <img id="profile-pic" class="w-20 h-20 rounded-full border-2 border-yellow-400 mx-auto sm:mx-0 mb-4 sm:mb-0 shadow-lg" src="" alt="Foto Profil">
      <div class="text-center sm:text-left">
        <h2 id="display-name" class="text-xl font-bold"></h2>
        <p id="email" class="text-gray-400 text-sm"></p>
        <p id="phone" class="text-gray-400 text-sm"></p>
      </div>
      <span id="status" class="mt-3 sm:mt-0 sm:ml-auto bg-yellow-500 text-black text-sm font-bold px-3 py-1 rounded-lg shadow"></span>
    </div>

    <!-- Info Section -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
      <!-- Founder Pack -->
      <div class="bg-gray-700 p-4 rounded-xl text-center md:text-left shadow-md">
        <h3 class="text-lg font-bold mb-2">🎁 Paket Founder</h3>
        <p id="pack" class="text-yellow-400 text-xl font-bold">Free</p>
        <button id="upgrade" class="mt-3 bg-gradient-to-r from-blue-500 to-indigo-500 hover:from-blue-400 hover:to-indigo-400 px-4 py-2 rounded-lg font-bold text-sm transition-all duration-300 shadow-md">Upgrade</button>
      </div>

      <!-- Referral -->
      <div class="bg-gray-700 p-4 rounded-xl shadow-md">
        <h3 class="text-lg font-bold mb-2">⭐ Referral</h3>
        <p class="text-sm text-gray-300 mb-2">Bagikan link ini:</p>
        <input id="referral-link" class="w-full bg-gray-900 text-sm p-2 rounded border border-gray-600" readonly>
        <div class="flex mt-2 gap-2">
          <button id="copy-ref" class="flex-1 bg-yellow-500 text-black px-3 py-1 rounded text-sm font-bold hover:bg-yellow-400 transition">Copy</button>
        </div>
        <p id="ref-count" class="text-xs text-green-400 mt-2 font-bold">Total Referral: 0</p>
      </div>

      <!-- Reward -->
      <div class="bg-gray-700 p-4 rounded-xl text-center md:text-left shadow-md">
        <h3 class="text-lg font-bold mb-2">💰 Reward</h3>
        <p id="reward" class="text-green-400 text-2xl font-bold">Rp 0</p>
      </div>

      <!-- Status Player -->
      <div class="bg-gray-700 p-4 rounded-xl shadow-md">
        <h3 class="text-lg font-bold mb-2">⚔️ Status Player</h3>
        <ul class="text-sm text-gray-300 space-y-1">
          <li id="status-player">Free Player</li>
          <li>✅ Google Verified</li>
          <li id="badge">❌ No Founder Badge</li>
        </ul>
      </div>
    </div>

    <!-- Logout -->
    <div class="text-center mb-6">
      <button id="logout" class="bg-red-500 px-4 py-2 rounded-lg font-bold hover:bg-red-400 transition-all shadow-md">Logout</button>
    </div>

    <!-- Sosial Media -->
    <div class="text-center space-y-3">
      <p class="text-sm text-gray-400">Ikuti kami di sosial media:</p>
      <div class="flex justify-center gap-4">
        <a href="https://facebook.com/YourPage" target="_blank" class="bg-blue-600 hover:bg-blue-500 px-4 py-2 rounded-lg font-bold text-sm shadow-md transition">Facebook</a>
        <a href="https://t.me/YourTelegram" target="_blank" class="bg-sky-500 hover:bg-sky-400 px-4 py-2 rounded-lg font-bold text-sm shadow-md transition">Telegram</a>
      </div>
    </div>
  </div>

  <!-- Loading -->
  <div id="loading" class="flex flex-col items-center text-gray-300 space-y-3">
    <svg class="animate-spin h-8 w-8 text-yellow-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
      <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
      <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8z"></path>
    </svg>
    <p class="animate-pulse">⏳ Memuat dashboard...</p>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { getFirestore, doc, getDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    // 🔹 Config Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyBVCCuIU6O_kwLIu18zFmLKx4nAZ15S5gU",
      authDomain: "indomon-quest.firebaseapp.com",
      projectId: "indomon-quest",
      storageBucket: "indomon-quest.firebasestorage.app",
      messagingSenderId: "483061706588",
      appId: "1:483061706588:web:ef2e02e7e8c2f08c12db99"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // Elemen UI
    const dashboard = document.getElementById("dashboard");
    const loading = document.getElementById("loading");
    const displayName = document.getElementById("display-name");
    const email = document.getElementById("email");
    const phone = document.getElementById("phone");
    const profilePic = document.getElementById("profile-pic");
    const pack = document.getElementById("pack");
    const status = document.getElementById("status");
    const referralLink = document.getElementById("referral-link");
    const reward = document.getElementById("reward");
    const badge = document.getElementById("badge");
    const statusPlayer = document.getElementById("status-player");
    const refCount = document.getElementById("ref-count");

    // 🔹 Auth state listener
    onAuthStateChanged(auth, async (user) => {
      if (user) {
        displayName.textContent = user.displayName || "Player";
        email.textContent = user.email;
        profilePic.src = user.photoURL || "https://i.pravatar.cc/100";

        const userRef = doc(db, "users", user.uid);

        // 🔄 Real-time listener untuk update otomatis
        onSnapshot(userRef, (snap) => {
          if (snap.exists()) {
            const data = snap.data();

            pack.textContent = data.pack || "Free";
            phone.textContent = data.phone || "Nomor belum terdaftar";
            refCount.textContent = `Total Referral: ${data.totalReferral || 0}`;
            referralLink.value = `https://www.indomonquest.web.id/?ref=${data.refNumber}`;
            reward.textContent = data.reward ? `Rp ${data.reward.toLocaleString()}` : "Rp 0";

            // 🔹 Update status player & badge
            if (data.pack && data.pack.toLowerCase() !== "free") {
              status.textContent = `${data.pack.toUpperCase()} Founder`;
              status.className = "mt-3 sm:mt-0 sm:ml-auto bg-green-400 text-black text-sm font-bold px-3 py-1 rounded-lg shadow";
              badge.textContent = "🏅 Founder Badge";
              statusPlayer.textContent = "Premium Player";
              statusPlayer.className = "text-green-400 font-bold";
            } else {
              status.textContent = "Free Player";
              status.className = "mt-3 sm:mt-0 sm:ml-auto bg-yellow-500 text-black text-sm font-bold px-3 py-1 rounded-lg shadow";
              badge.textContent = "❌ No Founder Badge";
              statusPlayer.textContent = "Free Player";
              statusPlayer.className = "text-gray-300";
            }

            // ✅ Fade-in animasi
            loading.classList.add("hidden");
            dashboard.classList.remove("hidden");
            setTimeout(() => {
              dashboard.classList.add("opacity-100", "scale-100");
            }, 50);
          }
        });
      } else {
        window.location.href = "index.html";
      }
    });

    // Copy Referral
    document.getElementById("copy-ref").addEventListener("click", () => {
      referralLink.select();
      document.execCommand("copy");
      alert("✅ Referral link disalin!");
    });

    // Logout
    document.getElementById("logout").addEventListener("click", async () => {
      await signOut(auth);
      window.location.href = "index.html";
    });

    // Upgrade → redirect ke halaman paket
    document.getElementById("upgrade").addEventListener("click", () => {
      window.location.href = "https://www.indomonquest.web.id/#packages";
    });
  </script>
</body>
</html>
